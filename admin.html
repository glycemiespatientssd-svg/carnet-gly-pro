<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEN'Diab√®te - Administration</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --light: #f8fafc;
            --dark: #2d3748;
            --gray: #718096;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: var(--light);
            color: var(--dark);
        }
        
        .admin-bar {
            background: var(--dark);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .small-logo {
            width: 24px;
            height: 24px;
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
        }
        
        h1 {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .revenue {
            border-left-color: var(--success);
        }
        
        .revenue .stat-value {
            color: var(--success);
        }
        
        .users {
            border-left-color: var(--secondary);
        }
        
        .users .stat-value {
            color: var(--secondary);
        }
        
        .packs {
            border-left-color: var(--warning);
        }
        
        .packs .stat-value {
            color: var(--warning);
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            background: #f8fafc;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 0;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            padding: 25px;
        }
        
        .card h2 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        th {
            background: var(--primary);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .user-form {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .status-active {
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-inactive {
            background: var(--gray);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            margin-top: 60px;
            border-top: 1px solid #e2e8f0;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Barre admin -->
    <div class="admin-bar">
        <div class="admin-info">
            <img src="https://i.postimg.cc/jS7RdL11/logo-v2.png" alt="SEN'Diab√®te" class="small-logo">
            <span>Administration SEN'Diab√®te</span>
        </div>
        <button class="logout-btn" onclick="logout()">D√©connexion</button>
    </div>

    <div class="container">
        <header>
            <div class="logo-container">
                <img src="https://i.postimg.cc/jS7RdL11/logo-v2.png" alt="SEN'Diab√®te" class="logo-img">
                <div>
                    <h1>Tableau de Bord Administrateur</h1>
                    <p class="subtitle">Gestion compl√®te de la plateforme</p>
                </div>
            </div>
        </header>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card revenue">
                <div class="stat-value" id="totalRevenue">0 FCFA</div>
                <div class="stat-label">Revenus totaux</div>
            </div>
            <div class="stat-card users">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-label">M√©decins actifs</div>
            </div>
            <div class="stat-card packs">
                <div class="stat-value" id="totalPacks">0</div>
                <div class="stat-label">Packs vendus</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeCarnets">0</div>
                <div class="stat-label">Carnets actifs</div>
            </div>
        </div>

        <!-- Navigation par onglets -->
        <div class="tabs">
            <div class="tab active" data-tab="users">üë• Utilisateurs</div>
            <div class="tab" data-tab="packs">üì¶ Packs & Revenus</div>
            <div class="tab" data-tab="settings">‚öôÔ∏è Param√®tres</div>
        </div>

        <!-- Onglet Utilisateurs -->
        <div class="tab-content active" id="users">
            <div class="card">
                <h2>Gestion des m√©decins</h2>
                
                <div class="user-form">
                    <h3>Ajouter un m√©decin</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom complet :</label>
                            <input type="text" id="newDoctorName" placeholder="Dr. Sow">
                        </div>
                        <div class="form-group">
                            <label>Email :</label>
                            <input type="email" id="newDoctorEmail" placeholder="dr.sow@email.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√©l√©phone :</label>
                            <input type="text" id="newDoctorPhone" placeholder="+221 77 123 45 67">
                        </div>
                        <div class="form-group">
                            <label>Code d'acc√®s :</label>
                            <input type="text" id="newDoctorCode" placeholder="4 2 8 7">
                        </div>
                    </div>
                    <button class="btn" onclick="addDoctor()">‚ûï Ajouter le m√©decin</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nom</th>
                            <th>Contact</th>
                            <th>Code</th>
                            <th>Date cr√©ation</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="doctorsTable">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Onglet Packs & Revenus -->
        <div class="tab-content" id="packs">
            <div class="card">
                <h2>Ventes et revenus</h2>
                
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-value" id="monthRevenue">0 FCFA</div>
                        <div class="stat-label">Ce mois</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgPackPrice">80,000 FCFA</div>
                        <div class="stat-label">Prix moyen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="conversionRate">0%</div>
                        <div class="stat-label">Taux conversion</div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>M√©decin</th>
                            <th>Pack</th>
                            <th>Prix</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="salesTable">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Onglet Param√®tres -->
        <div class="tab-content" id="settings">
            <div class="card">
                <h2>Param√®tres de la plateforme</h2>
                
                <div class="form-group">
                    <label>Prix du pack PRO :</label>
                    <input type="number" id="packPrice" value="80000" style="width: 200px;">
                    <button class="btn" onclick="updatePackPrice()" style="margin-left: 10px;">üíæ Mettre √† jour</button>
                </div>
                
                <div class="form-group">
                    <label>Nombre de carnets par pack :</label>
                    <input type="number" id="carnetsPerPack" value="50" style="width: 200px;">
                    <button class="btn" onclick="updateCarnetsPerPack()" style="margin-left: 10px;">üíæ Mettre √† jour</button>
                </div>
                
                <div class="form-group">
                    <label>Message de bienvenue :</label>
                    <textarea id="welcomeMessage" style="width: 100%; height: 100px; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px;">Bienvenue sur SEN'Diab√®te, votre solution de suivi glyc√©mique.</textarea>
                    <button class="btn" onclick="updateWelcomeMessage()" style="margin-top: 10px;">üíæ Mettre √† jour</button>
                </div>
                
                <div class="form-group">
                    <h3>Export des donn√©es</h3>
                    <button class="btn btn-success" onclick="exportData()">üìä Exporter donn√©es utilisateurs</button>
                    <button class="btn btn-warning" onclick="exportSales()">üí∞ Exporter donn√©es ventes</button>
                    <button class="btn btn-danger" onclick="backupData()">üíæ Sauvegarde compl√®te</button>
                </div>
            </div>
        </div>

        <footer>
            <img src="https://i.postimg.cc/jS7RdL11/logo-v2.png" alt="SEN'Diab√®te" class="small-logo" style="margin-bottom: 10px;">
            <p>SEN'Diab√®te - Tableau de bord administrateur</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">Version 1.0 | ¬© 2024</p>
        </footer>
    </div>

    <script>
        // ===== DONN√âES ADMIN =====
        let adminData = {
            users: [],
            sales: [],
            settings: {
                packPrice: 80000,
                carnetsPerPack: 50,
                welcomeMessage: "Bienvenue sur SEN'Diab√®te, votre solution de suivi glyc√©mique."
            },
            stats: {
                totalRevenue: 0,
                totalUsers: 0,
                totalPacks: 0,
                activeCarnets: 0,
                monthRevenue: 0,
                conversionRate: 0
            }
        };

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAdminAuth()) return;
            
            loadAdminData();
            setupTabs();
            updateDashboard();
        });

        function checkAdminAuth() {
            // V√©rification simple de l'acc√®s admin
            const isAdmin = confirm("Acc√®s administrateur - Entrez le mot de passe admin :");
            if (!isAdmin) {
                window.location.href = 'index.html';
                return false;
            }
            return true;
        }

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        function loadAdminData() {
            const saved = localStorage.getItem('sendiabete_admin');
            if (saved) {
                adminData = JSON.parse(saved);
            }
            
            // Charger aussi les donn√©es des m√©decins depuis l'app
            const appData = localStorage.getItem('sendiabete_data');
            if (appData) {
                const data = JSON.parse(appData);
                // Simuler des donn√©es pour la d√©mo
                if (adminData.users.length === 0) {
                    adminData.users = [
                        {
                            id: "DOC001",
                            name: "Dr. Sow",
                            email: "dr.sow@clinique.sn",
                            phone: "+221 77 123 45 67",
                            code: "4 2 8 7",
                            dateCreated: "2024-01-15",
                            status: "active",
                            packs: 2
                        },
                        {
                            id: "DOC002", 
                            name: "Dr. Diallo",
                            email: "dr.diallo@hopital.sn",
                            phone: "+221 76 987 65 43",
                            code: "1 3 5 7",
                            dateCreated: "2024-02-01",
                            status: "active",
                            packs: 1
                        }
                    ];
                }
                
                if (adminData.sales.length === 0) {
                    adminData.sales = [
                        {
                            id: "SALE001",
                            doctorId: "DOC001",
                            doctorName: "Dr. Sow",
                            packType: "PRO",
                            price: 80000,
                            date: "2024-01-20",
                            status: "completed"
                        },
                        {
                            id: "SALE002",
                            doctorId: "DOC001", 
                            doctorName: "Dr. Sow",
                            packType: "PRO",
                            price: 80000,
                            date: "2024-02-15",
                            status: "completed"
                        },
                        {
                            id: "SALE003",
                            doctorId: "DOC002",
                            doctorName: "Dr. Diallo", 
                            packType: "PRO",
                            price: 80000,
                            date: "2024-02-10",
                            status: "completed"
                        }
                    ];
                }
            }
            
            saveAdminData();
        }

        function saveAdminData() {
            localStorage.setItem('sendiabete_admin', JSON.stringify(adminData));
        }

        function updateDashboard() {
            // Calculer les statistiques
            adminData.stats.totalUsers = adminData.users.length;
            adminData.stats.totalPacks = adminData.sales.length;
            adminData.stats.totalRevenue = adminData.sales.reduce((sum, sale) => sum + sale.price, 0);
            adminData.stats.monthRevenue = adminData.sales
                .filter(sale => sale.date.startsWith('2024-02'))
                .reduce((sum, sale) => sum + sale.price, 0);
            adminData.stats.activeCarnets = adminData.stats.totalPacks * adminData.settings.carnetsPerPack;
            adminData.stats.conversionRate = Math.round((adminData.stats.totalPacks / adminData.stats.totalUsers) * 100);

            // Mettre √† jour l'interface
            document.getElementById('totalRevenue').textContent = adminData.stats.totalRevenue.toLocaleString() + ' FCFA';
            document.getElementById('totalUsers').textContent = adminData.stats.totalUsers;
            document.getElementById('totalPacks').textContent = adminData.stats.totalPacks;
            document.getElementById('activeCarnets').textContent = adminData.stats.activeCarnets;
            document.getElementById('monthRevenue').textContent = adminData.stats.monthRevenue.toLocaleString() + ' FCFA';
            document.getElementById('conversionRate').textContent = adminData.stats.conversionRate + '%';

            // Mettre √† jour les tables
            updateDoctorsTable();
            updateSalesTable();
            updateSettingsForm();
        }

        function updateDoctorsTable() {
            const tbody = document.getElementById('doctorsTable');
            tbody.innerHTML = '';

            adminData.users.forEach(doctor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doctor.id}</td>
                    <td>${doctor.name}</td>
                    <td>${doctor.phone}<br><small>${doctor.email}</small></td>
                    <td>${doctor.code}</td>
                    <td>${doctor.dateCreated}</td>
                    <td><span class="status-${doctor.status}">${doctor.status === 'active' ? 'Actif' : 'Inactif'}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="editDoctor('${doctor.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteDoctor('${doctor.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSalesTable() {
            const tbody = document.getElementById('salesTable');
            tbody.innerHTML = '';

            adminData.sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.doctorName}</td>
                    <td>Pack ${sale.packType}</td>
                    <td>${sale.price.toLocaleString()} FCFA</td>
                    <td><span class="status-active">${sale.status}</span></td>
                    <td>
                        <button class="btn" onclick="viewSale('${sale.id}')">üëÅÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSettingsForm() {
            document.getElementById('packPrice').value = adminData.settings.packPrice;
            document.getElementById('carnetsPerPack').value = adminData.settings.carnetsPerPack;
            document.getElementById('welcomeMessage').value = adminData.settings.welcomeMessage;
        }

        // ===== FONCTIONS DE GESTION =====
        function addDoctor() {
            const name = document.getElementById('newDoctorName').value;
            const email = document.getElementById('newDoctorEmail').value;
            const phone = document.getElementById('newDoctorPhone').value;
            const code = document.getElementById('newDoctorCode').value;

            if (!name || !email || !phone || !code) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            const newDoctor = {
                id: 'DOC' + (adminData.users.length + 1).toString().padStart(3, '0'),
                name: name,
                email: email,
                phone: phone,
                code: code,
                dateCreated: new Date().toISOString().split('T')[0],
                status: 'active',
                packs: 0
            };

            adminData.users.push(newDoctor);
            saveAdminData();
            updateDashboard();
            
            // R√©initialiser le formulaire
            document.getElementById('newDoctorName').value = '';
            document.getElementById('newDoctorEmail').value = '';
            document.getElementById('newDoctorPhone').value = '';
            document.getElementById('newDoctorCode').value = '';
            
            alert('M√©decin ' + newDoctor.id + ' ajout√© avec succ√®s');
        }

        function editDoctor(doctorId) {
            const doctor = adminData.users.find(d => d.id === doctorId);
            if (doctor) {
                const newCode = prompt('Nouveau code d\'acc√®s:', doctor.code);
                if (newCode) {
                    doctor.code = newCode;
                    saveAdminData();
                    updateDashboard();
                    alert('Code mis √† jour pour ' + doctor.name);
                }
            }
        }

        function deleteDoctor(doctorId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce m√©decin ?')) {
                adminData.users = adminData.users.filter(d => d.id !== doctorId);
                saveAdminData();
                updateDashboard();
                alert('M√©decin supprim√©');
            }
        }

        function viewSale(saleId) {
            const sale = adminData.sales.find(s => s.id === saleId);
            if (sale) {
                alert(`D√©tails de la vente:\n\nM√©decin: ${sale.doctorName}\nPack: ${sale.packType}\nPrix: ${sale.price.toLocaleString()} FCFA\nDate: ${sale.date}\nStatut: ${sale.status}`);
            }
        }

        function updatePackPrice() {
            const newPrice = parseInt(document.getElementById('packPrice').value);
            if (newPrice && newPrice > 0) {
                adminData.settings.packPrice = newPrice;
                saveAdminData();
                alert('Prix du pack mis √† jour: ' + newPrice.toLocaleString() + ' FCFA');
            }
        }

        function updateCarnetsPerPack() {
            const newCount = parseInt(document.getElementById('carnetsPerPack').value);
            if (newCount && newCount > 0) {
                adminData.settings.carnetsPerPack = newCount;
                saveAdminData();
                updateDashboard();
                alert('Nombre de carnets par pack mis √† jour: ' + newCount);
            }
        }

        function updateWelcomeMessage() {
            const newMessage = document.getElementById('welcomeMessage').value;
            adminData.settings.welcomeMessage = newMessage;
            saveAdminData();
            alert('Message de bienvenue mis √† jour');
        }

        function exportData() {
            const dataStr = JSON.stringify(adminData.users, null, 2);
            downloadFile(dataStr, 'sendiabete_utilisateurs.json');
        }

        function exportSales() {
            const dataStr = JSON.stringify(adminData.sales, null, 2);
            downloadFile(dataStr, 'sendiabete_ventes.json');
        }

        function backupData() {
            const allData = {
                admin: adminData,
                app: localStorage.getItem('sendiabete_data')
            };
            const dataStr = JSON.stringify(allData, null, 2);
            downloadFile(dataStr, 'sendiabete_backup_complet.json');
        }

        function downloadFile(data, filename) {
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        function logout() {
            if (confirm('D√©connexion administrateur ?')) {
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>